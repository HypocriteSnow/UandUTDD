# 关卡编辑器使用手册 (Level Editor Manual)

## 1. 快速开始

### 1.1 启动编辑器
1. 在 Unity 顶部菜单栏选择 `ArknightsLite -> Level Editor`。
2. 将打开的窗口停靠在方便操作的位置（建议与 Scene 视图并列）。

### 1.2 准备工作
在开始编辑前，请确保已有以下资源：
- **Level Config**：关卡配置文件（可以在编辑器中直接创建，或右键 `Create -> ArknightsLite -> Level Config`）。
- **Grid Visual Config**：视觉配置文件（右键 `Create -> ArknightsLite -> Grid Visual Config`）。

### 1.3 进入编辑模式
1. 在编辑器窗口中，分别拖入 `Level Config` 和 `Visual Config`。
2. 点击 **"进入编辑模式"** 按钮。
3. Scene 视图中将生成可视化的网格。

---

## 2. 关卡管理工作流

### 2.1 创建新关卡配置
使用编辑器窗口顶部的 **"关卡管理"** 区域可以快速创建新关卡：

1. 在 **"新关卡名称"** 字段输入关卡名称（如 `Level_1_1`）。
2. 点击 **"创建配置"** 按钮。
3. 系统将自动：
   - 在 `Assets/Resources/Levels/Configs/` 目录创建配置文件。
   - 设置默认值（10x10 地图，起点 (0,0)，终点 (9,9)）。
   - 将新配置自动加载到编辑器中。

**注意**：如果配置文件已存在，系统会提示是否覆盖。

### 2.2 构建关卡场景
创建或编辑好关卡配置后，可以快速生成对应的场景文件：

1. 确保已加载 `Level Config` 和 `Visual Config`。
2. 点击 **"构建场景"** 按钮。
3. 系统将自动：
   - 创建新的空白场景。
   - 添加必需的游戏对象：
     - `GameManager`（包含 `GameMain` 组件）
     - `GridVisualizer`（包含 `GridRenderer` 组件）
     - `Main Camera`（配置俯视角度）
     - `Directional Light`
   - 将当前的 `LevelConfig` 和 `GridVisualConfig` 关联到场景中的组件。
   - 保存场景到 `Assets/Scenes/Levels/{配置名称}.unity`。
   - 将场景添加到构建设置中。

**提示**：相机会自动调整位置和角度，确保整个地图都在视野内。

### 2.3 从场景加载配置
如果打开了已有的关卡场景，可以使用此功能快速加载场景中的配置：

1. 打开一个关卡场景（`Assets/Scenes/Levels/` 目录）。
2. 在编辑器窗口点击 **"从场景加载"** 按钮。
3. 系统将自动：
   - 从场景中的 `GameMain` 组件读取 `LevelConfig`。
   - 从场景中的 `GridRenderer` 组件读取 `GridVisualConfig`。
   - 将它们加载到编辑器窗口中。

**使用场景**：当你忘记当前场景对应哪个配置文件时，此功能非常有用。

### 2.4 完整工作流示例
**创建新关卡的推荐流程**：

1. 打开关卡编辑器 (`ArknightsLite -> Level Editor`)。
2. 在 **"关卡管理"** 区域输入关卡名称（如 `TestLevel`），点击 **"创建配置"**。
3. 准备 `GridVisualConfig`（如果还没有，右键创建并配置）。
4. 将 `GridVisualConfig` 拖入编辑器窗口。
5. 点击 **"构建场景"** 生成场景文件。
6. 打开生成的场景，点击 **"进入编辑模式"**，开始编辑地形。
7. 使用笔刷工具和属性检查器调整地图。
8. 点击 **"保存并退出编辑模式"**。
9. 运行场景测试关卡。

---

## 3. 核心功能

### 3.1 笔刷工具 (Brush Tool)
在编辑器窗口下方勾选 **"启用笔刷"** 即可开启。

- **操作方式**：
  - **左键拖动**：在 Scene 视图的格子上涂抹，批量修改格子类型。
  - **快捷键切换**：
    - `1`: Ground (地面 - 绿色)
    - `2`: HighGround (高台 - 墨绿色)
    - `3`: Forbidden (禁区 - 白色)
    - `4`: Hole (坑洞 - 黑色)

- **笔刷高度**：
  - 通过滑块调整笔刷的高度等级 (0-3)。
  - 用于绘制不同高度的地形（如高台）。

### 3.2 属性检查器 (Inspector)
选中 Scene 视图中的任意格子，Inspector 面板将显示 `TileAuthoring` 组件：

- **基本信息**：
  - 显示当前坐标 `(X, Z)`。
  - **特殊状态提示**：如果是 **起点 (Spawn)** 或 **终点 (Goal)**，会显示醒目的提示框，说明其运行时行为（强制为 Ground 且可通行）。

- **格子属性**：
  - **Tile Type**：修改格子类型（Ground/HighGround/Forbidden/Hole）。
    - *智能联动*：修改类型会自动更新 `Walkable` 状态（例如 Forbidden 会自动取消 Walkable）。
  - **Height Level**：手动调整高度。
  - **Walkable**：手动覆盖通行性（可用于制作隐形墙或特殊地形）。
  - **Deploy Tag**：设置部署标签（如 "Melee", "Ranged"）。

### 3.3 快捷操作
- **保存**：点击 **"保存并退出编辑模式"**，或直接按 `Ctrl+S` 保存配置。
- **撤销**：支持 `Ctrl+Z` 撤销笔刷或属性修改操作。
- **重置**：点击 **"重新生成网格"** 可丢弃未保存的修改并重置为配置文件状态。

---

## 4. 最佳实践

### 4.1 起点与终点配置
- **配置位置**：起点和终点坐标在 `LevelConfig` 资源文件中配置（Inspector 列表），而非在编辑器中绘制。
- **运行时行为**：无论编辑器中将起点/终点涂抹为何种类型，运行时都会**强制初始化为 Ground**（可通行）。
- **视觉反馈**：
  - **起点**：显示为 **红色发光** 格子。
  - **终点**：显示为 **蓝色发光** 格子。

### 4.2 常见问题排查
- **Q: 为什么修改了格子类型，材质没有变化？**
  - A: 检查 `GridVisualConfig` 中是否配置了对应的材质。如果是起点/终点，它们会优先显示特殊材质。
  
- **Q: 为什么笔刷涂抹无效？**
  - A: 确保已勾选 "启用笔刷"，且鼠标点击在网格碰撞体范围内。

- **Q: 运行时敌人卡在起点不动？**
  - A: 请检查 `LevelConfig` 中的起点坐标是否正确。最新版本已修复此问题，起点会自动设为可通行。

---

## 5. 快捷键速查表

| 快捷键 | 功能 |
| :--- | :--- |
| `1` | 切换笔刷为 Ground |
| `2` | 切换笔刷为 HighGround |
| `3` | 切换笔刷为 Forbidden |
| `4` | 切换笔刷为 Hole |
| `Ctrl+Z` | 撤销操作 |
| `Ctrl+S` | 保存配置 (Unity 标准) |

---

*文档版本：v1.1 (2026-02-11)*
