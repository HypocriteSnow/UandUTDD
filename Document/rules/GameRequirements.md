# Arknights Lite - 游戏核心需求文档

## 1. 项目概述
本项目旨在复刻《明日方舟》的核心战斗系统，构建一个**确定性、数据驱动、高扩展性**的塔防战斗框架。首要目标是实现核心战斗循环，后续进行技能与机制扩展。

## 2. 核心底层系统架构 (The 5 Pillars)

### 2.1 网格数据与空间管理系统 (Grid & Spatial Management)
- **核心职能**：管理战场的静态与动态空间数据。
- **功能需求**：
  - **多层网格**：支持地面(Ground)、空中(Air)、特效(Effect)三层数据。
  - **动态地形**：支持运行时改变格子状态（如放置障碍物改变通行性）。
  - **坐标转换**：提供世界坐标(WorldPos)与逻辑坐标(GridPos)的相互转换，确保逻辑层与表现层分离。

### 2.2 单位实体架构 (Entity / Unit Architecture)
- **核心职能**：管理战场上所有活动对象的生命周期与组件。
- **功能需求**：
  - **组件化设计**：采用组合模式(Component Pattern)，包含属性(Attribute)、状态(State)、位置(GridPos)、阻挡(Block)等组件。
  - **对象池管理**：高频创建销毁的单位（如子弹、敌人）必须使用对象池。
  - **类型区分**：支持干员(Operator)、敌人(Enemy)、召唤物(Summon)、陷阱(Trap)。

### 2.3 寻路与动态阻挡系统 (Navigation & Dynamic Blocking)
- **核心职能**：处理单位移动与阻挡交互。
- **功能需求**：
  - **流场/动态A***：支持因障碍物放置而实时重算的寻路算法。
  - **阻挡逻辑**：
    - 物理层阻挡：当 `Enemy` 进入 `Operator` 格子且 `BlockCount > 0` 时触发。
    - 逻辑层状态：切换单位状态为 `Blocked` / `Blocking`。
  - **终点检测**：放置障碍物前的预判检测，防止死路。

### 2.4 攻击范围与索敌系统 (Range & Targeting)
- **核心职能**：确定攻击目标。
- **功能需求**：
  - **范围形状**：支持自定义攻击范围（如前方一格、周围八格、特殊形状）。
  - **索敌过滤器链 (Filter Chain)**：
    1. **范围检测**：在攻击范围内。
    2. **有效性检测**：非无敌、非隐匿（除非有反隐）。
    3. **优先级排序**：距离终点最近 > HP最低 > 防御最低等（可配置）。
  - **嘲讽机制**：支持全局或局部嘲讽等级(Taunt Level)打断常规索敌。

### 2.5 伤害计算与时间轴管理 (Damage Pipeline & Tick Manager)
- **核心职能**：执行数值结算与时间推进。
- **功能需求**：
  - **Tick 驱动**：所有逻辑（移动、攻击CD、SP回复）基于逻辑帧(Tick)而非 `Time.deltaTime`。
  - **伤害流水线**：
    - 流程：发起 -> 命中判定 -> 减伤计算 -> 扣血 -> 触发受击事件。
    - 伤害类型：物理(Physical)、法术(Magical)、真实(True)、治疗(Heal)。
  - **快照机制**：支持技能开启时的属性快照（Snapshot）。

---

## 3. MVP 开发路线图

### MVP 1.0：跑通流程 (Infrastructure & Basic Loop)
- **目标**：一个敌人从起点走到终点，经过一个无法互动的干员。
- **包含内容**：
  - 基础网格生成 (10x10)。
  - Tick 驱动的主循环。
  - 简单的实体移动逻辑。

### MVP 2.0：塔防核心 (Core Gameplay)
- **目标**：干员可以阻挡敌人，并进行攻击造成伤害。
- **包含内容**：
  - **阻挡系统**：敌人被干员卡住。
  - **索敌系统**：干员检测范围内敌人。
  - **基础伤害**：简单的 HP - ATK 结算。

### MVP 3.0：数值与策略 (Stats & Strategy)
- **目标**：引入防御、法抗、费用、朝向，具备游戏雏形。
- **包含内容**：
  - 完整的属性系统（攻防计算公式）。
  - 部署费用(Cost)与回复。
  - 干员朝向与攻击范围限制。

### MVP 4.0：技能与机制 (Skills & Mechanics)
- **目标**：干员可以释放技能，改变战局。
- **包含内容**：
  - SP 回复机制（自动/攻回/受回）。
  - 主动技能释放（改变攻击力/范围）。
  - 简单的 Buff 系统。
